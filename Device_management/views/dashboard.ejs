<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫£ng ƒëi·ªÅu khi·ªÉn - Qu·∫£n l√Ω thi·∫øt b·ªã</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Qu·∫£n l√Ω thi·∫øt b·ªã</h2>
      </div>
      <nav class="sidebar-nav">
        <a href="/dashboard" class="active">üìä B·∫£ng ƒëi·ªÅu khi·ªÉn</a>
        <a href="/rooms">üè† Qu·∫£n l√Ω ph√≤ng</a>
        <a href="/history">üìú L·ªãch s·ª≠</a>
      </nav>
      <div class="sidebar-footer">
        <a href="/logout">üö™ ƒêƒÉng xu·∫•t</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <h2>B·∫£ng ƒëi·ªÅu khi·ªÉn - T·ªïng quan ph√≤ng</h2>
      <div class="rooms-grid">
        <% if (rooms.length===0) { %>
          <p>Ch∆∞a c√≥ ph√≤ng n√†o. <a href="/rooms">Th√™m ph√≤ng m·ªõi</a></p>
          <% } else { %>
            <% rooms.forEach(function(room) { %>
              <div class="room-box" onclick="location.href='/dashboard/room/<%= room.id %>'"
                data-room-id="<%= room.id %>">
                <h3>
                  <%= room.name %>
                </h3>
                <p><strong>ƒê·ªãa ch·ªâ IP:</strong>
                  <%= room.ip %>
                </p>
                <p><strong>K·∫øt n·ªëi:</strong> <span class="status <%= room.is_online ? 'on' : 'off' %>">
                    <%= room.is_online ? 'üü¢ Tr·ª±c tuy·∫øn' : '‚ö´ Ngo·∫°i tuy·∫øn' %>
                  </span></p>
                <p><strong>Tr·∫°ng th√°i ƒë√®n:</strong> <span class="status <%= room.status_led ? 'on' : 'off' %>">
                    <%= room.status_led ? 'üí° B·∫≠t' : '‚ö´ T·∫Øt' %>
                  </span></p>
                <p><strong>Tr·∫°ng th√°i qu·∫°t:</strong> <span class="status <%= room.status_fan ? 'on' : 'off' %>">
                    <%= room.status_fan ? 'üåÄ B·∫≠t' : '‚ö´ T·∫Øt' %>
                  </span></p>
                <p class="temp-display" style="margin-top:10px; color:#FF6B6B; font-weight:bold; font-size:1.1em;">üå°Ô∏è
                  --¬∞C</p>
                <p class="humidity-display" style="margin-top:5px; color:#4ECDC4; font-weight:bold; font-size:1.1em;">üíß
                  --%</p>
              </div>
              <% }); %>
                <% } %>
      </div>
    </main>
  </div>
  <script>
    const socket = io();

    // Real-time c·∫≠p nh·∫≠t nhi·ªát ƒë·ªô v√† ƒë·ªô ·∫©m
    socket.on('data_from_esp32_update', data => {
      const roomBox = document.querySelector(`[data-room-id="${data.roomId}"]`);
      if (roomBox) {
        const tempDisplay = roomBox.querySelector('.temp-display');
        const humidityDisplay = roomBox.querySelector('.humidity-display');
        if (tempDisplay && humidityDisplay) {
          tempDisplay.textContent = `üå°Ô∏è ${parseFloat(data.temperature).toFixed(1)}¬∞C`;
          humidityDisplay.textContent = `üíß ${parseFloat(data.humidity).toFixed(1)}%`;

          // Hi·ªáu ·ª©ng flash khi c·∫≠p nh·∫≠t
          tempDisplay.style.animation = 'flash 0.5s';
          humidityDisplay.style.animation = 'flash 0.5s';
          setTimeout(() => {
            tempDisplay.style.animation = '';
            humidityDisplay.style.animation = '';
          }, 500);
        }
      }
    });

    // Reload khi thay ƒë·ªïi tr·∫°ng th√°i b·∫≠t/t·∫Øt
    // socket.on('roomStatusUpdate', data => {
    //   location.reload();
    // });
  </script>
  <style>
    @keyframes flash {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
        transform: scale(1.1);
      }
    }
  </style>
</body>

</html>