<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω ph√≤ng - Qu·∫£n l√Ω thi·∫øt b·ªã</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Qu·∫£n l√Ω thi·∫øt b·ªã</h2>
      </div>
      <nav class="sidebar-nav">
        <a href="/dashboard">üìä B·∫£ng ƒëi·ªÅu khi·ªÉn</a>
        <a href="/rooms" class="active">üè† Qu·∫£n l√Ω ph√≤ng</a>
        <a href="/history">üìú L·ªãch s·ª≠</a>
      </nav>
      <div class="sidebar-footer">
        <a href="/logout">üö™ ƒêƒÉng xu·∫•t</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
  <h2>Qu·∫£n l√Ω ph√≤ng</h2>
      <% if (errors && errors.length > 0) { %>
        <div class="alert alert-danger">
          <ul>
            <% errors.forEach(function(error) { %>
              <li><%= error.msg %></li>
            <% }); %>
          </ul>
        </div>
      <% } %>
      
      <form action="/rooms/add" method="POST" class="form-inline">
  <input type="text" name="name" placeholder="T√™n ph√≤ng (VD: Ph√≤ng kh√°ch)" required>
  <input type="text" name="ip" id="ipInput" placeholder="IP ho·∫∑c Domain (VD: 192.168.1.100 ho·∫∑c esp32.example.com:4000)" required>
  <button type="submit">‚ûï Th√™m ph√≤ng</button>
  <button type="button" onclick="showExamples()" style="background: #17a2b8; margin-left: 10px;">‚ùì V√≠ d·ª•</button>
      </form>
      
      <div id="examplesBox" style="display: none; background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196F3; animation: slideDown 0.3s ease;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <strong style="font-size: 16px;">üí° V√≠ d·ª• nh·∫≠p ƒë·ªãa ch·ªâ</strong>
          <button onclick="hideExamples()" style="background: transparent; border: none; font-size: 20px; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
          <!-- C·ªôt 1 -->
          <div>
            <p style="margin: 5px 0; font-weight: bold; color: #2196F3;">üìç IP c·ª•c b·ªô (Local):</p>
            <div class="example-item" onclick="fillExample('192.168.1.100')">
              <code>192.168.1.100</code>
            </div>
            <div class="example-item" onclick="fillExample('192.168.1.100:80')">
              <code>192.168.1.100:80</code>
            </div>
            
            <p style="margin: 15px 0 5px 0; font-weight: bold; color: #2196F3;">üñ•Ô∏è Localhost:</p>
            <div class="example-item" onclick="fillExample('localhost:4000')">
              <code>localhost:4000</code>
            </div>
            <div class="example-item" onclick="fillExample('127.0.0.1:4000')">
              <code>127.0.0.1:4000</code>
            </div>
          </div>
          
          <!-- C·ªôt 2 -->
          <div>
            <p style="margin: 5px 0; font-weight: bold; color: #2196F3;">üåê T√™n mi·ªÅn (Domain):</p>
            <div class="example-item" onclick="fillExample('esp32.example.com')">
              <code>esp32.example.com</code>
            </div>
            <div class="example-item" onclick="fillExample('esp32.example.com:4000')">
              <code>esp32.example.com:4000</code>
            </div>
            
            <p style="margin: 15px 0 5px 0; font-weight: bold; color: #2196F3;">‚òÅÔ∏è cPanel/Hosting:</p>
            <div class="example-item" onclick="fillExample('esp32simulator.yourdomain.com:4000')">
              <code>esp32simulator.yourdomain.com:4000</code>
            </div>
          </div>
        </div>
        
        <div style="background: #fff3cd; padding: 10px; border-radius: 6px; margin-top: 15px; border-left: 3px solid #ffc107;">
          <strong>‚ö†Ô∏è L∆∞u √Ω:</strong>
          <ul style="margin: 8px 0 0 20px; font-size: 13px;">
            <li>N·∫øu kh√¥ng ghi port, m·∫∑c ƒë·ªãnh s·∫Ω d√πng port <strong>80</strong></li>
            <li>ESP32 simulator th∆∞·ªùng ch·∫°y tr√™n port <strong>4000</strong> ho·∫∑c <strong>3000</strong></li>
            <li>Kh√¥ng c·∫ßn th√™m <code>http://</code> ho·∫∑c d·∫•u <code>/</code> ·ªü cu·ªëi</li>
          </ul>
        </div>
      </div>
      
      <style>
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .example-item {
          background: white;
          padding: 8px 12px;
          margin: 5px 0;
          border-radius: 5px;
          cursor: pointer;
          transition: all 0.2s;
          border: 2px solid #e0e0e0;
        }
        
        .example-item:hover {
          background: #2196F3;
          color: white;
          border-color: #2196F3;
          transform: translateX(5px);
        }
        
        .example-item code {
          font-size: 13px;
          font-weight: 500;
        }
        
        .example-item:hover code {
          color: white;
        }
      </style>

  <h3>Danh s√°ch ph√≤ng</h3>
      <table>
        <thead>
          <tr>
            <th>T√™n ph√≤ng</th>
            <th>ƒê·ªãa ch·ªâ (IP/Domain)</th>
            <th>K·∫øt n·ªëi</th>
            <th>Tr·∫°ng th√°i thi·∫øt b·ªã</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <% if (rooms.length === 0) { %>
            <tr><td colspan="5" style="text-align:center;">Ch∆∞a c√≥ ph√≤ng n√†o</td></tr>
          <% } else { %>
            <% rooms.forEach(function(room) { %>
              <tr>
                <td><strong><%= room.name %></strong></td>
                <td><%= room.ip %></td>
                <td>
                  <span class="status <%= room.isOnline ? 'on' : 'off' %>">
                    <%= room.isOnline ? 'üü¢ Tr·ª±c tuy·∫øn' : '‚ö´ Ngo·∫°i tuy·∫øn' %>
                  </span>
                </td>
                <td><span class="status <%= room.status ? 'on' : 'off' %>"><%= room.status ? 'üí° B·∫≠t' : '‚ö´ T·∫Øt' %></span></td>
                <td>
                  <button onclick="location.href='/dashboard/room/<%= room.id %>'">üìà Xem chi ti·∫øt</button>
                  <button class="btn-warning btn-edit" data-id="<%= room.id %>" data-name="<%= room.name %>" data-ip="<%= room.ip %>">‚úèÔ∏è S·ª≠a</button>
                  <form action="/rooms/delete/<%= room.id %>" method="POST" style="display:inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng n√†y?')">
                    <button type="submit" class="btn-danger">‚ùå X√≥a</button>
                  </form>
                </td>
              </tr>
            <% }); %>
          <% } %>
        </tbody>
      </table>
    </main>
  </div>
  <script>
    // X·ª≠ l√Ω s·ª± ki·ªán click cho c√°c n√∫t S·ª≠a
    document.addEventListener('DOMContentLoaded', function() {
      const editButtons = document.querySelectorAll('.btn-edit');
      editButtons.forEach(function(btn) {
        btn.addEventListener('click', function() {
          const id = this.getAttribute('data-id');
          const name = this.getAttribute('data-name');
          const ip = this.getAttribute('data-ip');
          editRoom(id, name, ip);
        });
      });
    });

    function editRoom(id, name, ip) {
      const newName = prompt('Nh·∫≠p t√™n ph√≤ng m·ªõi:', name);
      const newIp = prompt('Nh·∫≠p ƒë·ªãa ch·ªâ m·ªõi (IP/Domain v·ªõi port):\nV√≠ d·ª•: 192.168.1.100:80 ho·∫∑c esp32.example.com:4000', ip);
      if (newName && newIp) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/rooms/edit/' + id;
        const nameInput = document.createElement('input');
        nameInput.type = 'hidden';
        nameInput.name = 'name';
        nameInput.value = newName;
        const ipInput = document.createElement('input');
        ipInput.type = 'hidden';
        ipInput.name = 'ip';
        ipInput.value = newIp;
        form.appendChild(nameInput);
        form.appendChild(ipInput);
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>
</body>
</html>
